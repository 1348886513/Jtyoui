

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>jtyoui.time.nlptime.timeunit &mdash; jtyoui 2019.12.11 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> jtyoui
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">jtyoui</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">模块代码</a> &raquo;</li>
        
      <li>jtyoui.time.nlptime.timeunit</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>jtyoui.time.nlptime.timeunit 源代码</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python3.7</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># @Time  : 2019/12/9 13:30</span>
<span class="c1"># @Author: Jtyoui@qq.com</span>
<span class="kn">from</span> <span class="nn">jtyoui.plunar</span> <span class="k">import</span> <span class="n">LunarSolarDateConverter</span><span class="p">,</span> <span class="n">LunarDate</span>
<span class="kn">import</span> <span class="nn">regex</span> <span class="k">as</span> <span class="nn">re</span>  <span class="c1"># pip install regex==2.5.65</span>
<span class="kn">import</span> <span class="nn">arrow</span>  <span class="c1"># pip install arrow==0.13.1</span>
<span class="kn">import</span> <span class="nn">copy</span>


<div class="viewcode-block" id="TimePoint"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimePoint">[文档]</a><span class="k">class</span> <span class="nc">TimePoint</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;六个字段分别是：年-月-日-时-分-秒，&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="RangeTimeEnum"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.RangeTimeEnum">[文档]</a><span class="k">class</span> <span class="nc">RangeTimeEnum</span><span class="p">:</span>
    <span class="n">day_break</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># 黎明</span>
    <span class="n">early_morning</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># 早</span>
    <span class="n">morning</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># 上午</span>
    <span class="n">noon</span> <span class="o">=</span> <span class="mi">12</span>  <span class="c1"># 中午、午间</span>
    <span class="n">afternoon</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># 下午、午后</span>
    <span class="n">night</span> <span class="o">=</span> <span class="mi">18</span>  <span class="c1"># 晚上、傍晚</span>
    <span class="n">lateNight</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># 晚、晚间</span>
    <span class="n">midNight</span> <span class="o">=</span> <span class="mi">23</span>  <span class="c1"># 深夜</span>

<div class="viewcode-block" id="RangeTimeEnum.name"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.RangeTimeEnum.name">[文档]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">RangeTimeEnum</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">RangeTimeEnum</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span></div></div>


<div class="viewcode-block" id="TimeUnit"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit">[文档]</a><span class="k">class</span> <span class="nc">TimeUnit</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exp_time</span><span class="p">,</span> <span class="n">normalizer</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;时间语句分析&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_no_year</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span> <span class="o">=</span> <span class="n">exp_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span> <span class="o">=</span> <span class="n">normalizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tp</span> <span class="o">=</span> <span class="n">TimePoint</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tp_origin</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isFirstTimeSolveContext</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_normalization</span><span class="p">()</span>

<div class="viewcode-block" id="TimeUnit.time_normalization"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.time_normalization">[文档]</a>    <span class="k">def</span> <span class="nf">time_normalization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_year</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_month</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_day</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_month_fuzzy_day</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_cur_related</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_hour</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_minute</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_second</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_special</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_span_related</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">norm_set_holiday</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modify_time_base</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tp_origin</span><span class="o">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span>

        <span class="c1"># 判断是时间点还是时间区间</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span><span class="p">:</span>
            <span class="n">days</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">days</span> <span class="o">+=</span> <span class="mi">365</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">days</span> <span class="o">+=</span> <span class="mi">30</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">days</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">+</span> <span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="n">unit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">seconds</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">days</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">invalidSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeSpan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_span</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">seconds</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">time_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">unit_pointer</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">while</span> <span class="n">unit_pointer</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">unit_pointer</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">unit_pointer</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">unit_pointer</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_grid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.gen_span"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.gen_span">[文档]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">gen_span</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">seconds</span> <span class="o">%</span> <span class="p">(</span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(((</span><span class="n">seconds</span> <span class="o">%</span> <span class="p">(</span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span> <span class="o">%</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(((</span><span class="n">seconds</span> <span class="o">%</span> <span class="p">(</span><span class="mi">3600</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span> <span class="o">%</span> <span class="mi">3600</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">days</span> <span class="o">+</span> <span class="n">day</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; days, &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">:</span><span class="si">%02d</span><span class="s2">:</span><span class="si">%02d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.gen_time"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.gen_time">[文档]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">gen_time</span><span class="p">(</span><span class="n">unit</span><span class="p">):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;1970-01-01 00:00:00&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">month</span><span class="o">=</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">day</span><span class="o">=</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">minute</span><span class="o">=</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">unit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">second</span><span class="o">=</span><span class="n">unit</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">time</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_year"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_year">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_year</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;该方法识别时间表达式单元的年字段&quot;&quot;&quot;</span>
        <span class="c1"># 一位数表示的年份</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;![0-9])[0-9]</span><span class="si">{1}</span><span class="s2">(?=年)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>

        <span class="c1"># 两位数表示的年份</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;[0-9]</span><span class="si">{2}</span><span class="s2">(?=年)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>

        <span class="c1"># 三位数表示的年份</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;![0-9])[0-9]</span><span class="si">{3}</span><span class="s2">(?=年)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>

        <span class="c1"># 四位数表示的年份</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;[0-9]</span><span class="si">{4}</span><span class="s2">(?=年)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_month"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_month">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_month</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;该方法识别时间表达式单元的月字段 &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;((10)|(11)|(12)|([1-9]))(?=月)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="c1"># 处理倾向于未来时间的情况</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_month_fuzzy_day"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_month_fuzzy_day">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_month_fuzzy_day</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;兼容模糊写法:该方法识别时间表达式单元的月、日字段&quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;((10)|(11)|(12)|([1-9]))(月|</span><span class="se">\\</span><span class="s2">.|</span><span class="se">\\</span><span class="s2">-)([0-3][0-9]|[1-9])&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">match_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;(月|</span><span class="se">\\</span><span class="s2">.|</span><span class="se">\\</span><span class="s2">-)&quot;</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">match_str</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="n">month</span> <span class="o">=</span> <span class="n">match_str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">start</span><span class="p">]</span>
                <span class="n">day</span> <span class="o">=</span> <span class="n">match_str</span><span class="p">[</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
                <span class="c1"># 处理倾向于未来时间的情况</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_day"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_day">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_day</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;该方法识别时间表达式单元的日字段 &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;((?&lt;!</span><span class="se">\\</span><span class="s2">d))([0-3][0-9]|[1-9])(?=(日|号))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="c1"># 处理倾向于未来时间的情况</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.daytime"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.daytime">[文档]</a>    <span class="k">def</span> <span class="nf">daytime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># 增加对没有明确时间点，只写了凌晨这种情况的处理</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">RangeTimeEnum</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="mi">12</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">23</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">12</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
            <span class="c1"># 处理倾向于未来时间的情况</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_hour"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_hour">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_hour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;该方法识别时间表达式单元的时字段&quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;!(周|星期))([0-2]?[0-9])(?=(点|时))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="c1"># 处理倾向于未来时间的情况</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># 1.中午/午间0-10点视为12-22点</span>
        <span class="c1"># 2.下午/午后0-11点视为12-23点</span>
        <span class="c1"># 3.晚上/傍晚/晚间/晚1-11点视为13-23点，12点视为0点</span>
        <span class="c1"># 4.0-11点pm/PM视为12-23点</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;凌晨&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daytime</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="s1">&#39;day_break&#39;</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;早上|早晨|早间|晨间|今早|明早|早|清晨&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daytime</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="s1">&#39;early_morning&#39;</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;上午&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">daytime</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="s1">&#39;morning&#39;</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(中午)|(午间)|白天&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">12</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>  <span class="c1"># 增加对没有明确时间点，只写了中午/午间这种情况的处理</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">RangeTimeEnum</span><span class="o">.</span><span class="n">noon</span>
            <span class="c1"># 处理倾向于未来时间的情况</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(下午)|(午后)|(pm)|(PM)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">12</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">RangeTimeEnum</span><span class="o">.</span><span class="n">afternoon</span>
            <span class="c1"># 处理倾向于未来时间的情况</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;晚上|夜间|夜里|今晚|明晚|晚|夜里&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">12</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">RangeTimeEnum</span><span class="o">.</span><span class="n">lateNight</span>
            <span class="c1"># 处理倾向于未来时间的情况</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_minute"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_minute">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_minute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;该方法识别时间表达式单元的分字段 &quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;([0-9]+(?=分(?!钟)))|((?&lt;=((?&lt;!小)[点时]))[0-5]?[0-9](?!刻))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
                <span class="c1"># 处理倾向于未来时间的情况</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># 加对一刻，半，3刻的正确识别（1刻为15分，半为30分，3刻为45分）</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;=[点时])[1一]刻(?!钟)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;=[点时])半&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;=[点时])[3三]刻(?!钟)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">45</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_second"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_second">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_second</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;添加了省略秒说法的时间：如17点15分32&quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;([0-9]+(?=秒))|((?&lt;=分)[0-5]?[0-9])&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_special"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_special">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_special</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;该方法识别特殊形式的时间表达式单元的各个字段&quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(晚上|夜间|夜里|今晚|明晚|晚|夜里|下午|午后)(?&lt;!(周|星期))([0-2]?[0-9]):[0-5]?[0-9]:[0-5]?[0-9]&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;([0-2]?[0-9]):[0-5]?[0-9]:[0-5]?[0-9]&#39;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">12</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(晚上|夜间|夜里|今晚|明晚|晚|夜里|下午|午后)(?&lt;!(周|星期))([0-2]?[0-9]):[0-5]?[0-9]&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;([0-2]?[0-9]):[0-5]?[0-9]&#39;</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
                <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">12</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;!(周|星期))([0-2]?[0-9]):[0-5]?[0-9]:[0-5]?[0-9](PM|pm|p</span><span class="se">\\</span><span class="s2">.m)&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;([0-2]?[0-9]):[0-5]?[0-9]:[0-5]?[0-9]&#39;</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
                <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">12</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;!(周|星期))([0-2]?[0-9]):[0-5]?[0-9](PM|pm|p.m)&quot;</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">rule</span> <span class="o">=</span> <span class="s1">&#39;([0-2]?[0-9]):[0-5]?[0-9]&#39;</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
                    <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                    <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">12</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;!(周|星期|晚上|夜间|夜里|今晚|明晚|晚|夜里|下午|午后))([0-2]?[0-9]):[0-5]?[0-9]:[0-5]?[0-9]&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;!(周|星期|晚上|夜间|夜里|今晚|明晚|晚|夜里|下午|午后))([0-2]?[0-9]):[0-5]?[0-9]&quot;</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
                    <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">isAllDayTime</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;[0-9]?[0-9]?[0-9]</span><span class="si">{2}</span><span class="s2">-((10)|(11)|(12)|([1-9]))-((?&lt;!</span><span class="se">\\</span><span class="s2">d))([0-3][0-9]|[1-9])&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;[0-9]?[0-9]?[0-9]</span><span class="si">{2}</span><span class="s2">/((10)|(11)|(12)|([1-9]))/((?&lt;!</span><span class="se">\\</span><span class="s2">d))([0-3][0-9]|[1-9])&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;((10)|(11)|(12)|([1-9]))/((?&lt;!</span><span class="se">\\</span><span class="s2">d))([0-3][0-9]|[1-9])/[0-9]?[0-9]?[0-9]</span><span class="si">{2}</span><span class="s2">&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;[0-9]?[0-9]?[0-9]</span><span class="si">{2}</span><span class="se">\\</span><span class="s2">.((10)|(11)|(12)|([1-9]))</span><span class="se">\\</span><span class="s2">.((?&lt;!</span><span class="se">\\</span><span class="s2">d))([0-3][0-9]|[1-9])&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_target</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="n">tmp_parser</span> <span class="o">=</span> <span class="n">tmp_target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp_parser</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_base_related"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_base_related">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_base_related</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;设置以上文时间为基准的时间偏移计算&quot;&quot;&quot;</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="p">,</span> <span class="s2">&quot;YYYY-M-D-H-m-s&quot;</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=天[以之]?前)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="n">day</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=天[以之]?后)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">day</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=(个)?月[以之]?前)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">months</span><span class="o">=-</span><span class="n">month</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=(个)?月[以之]?后)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">month</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=年[以之]?前)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">years</span><span class="o">=-</span><span class="n">year</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=年[以之]?后)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">day</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_span_related"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_span_related">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_span_related</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;设置时间长度相关的时间表达式&quot;&quot;&quot;</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=个月(?![以之]?[前后]))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=天(?![以之]?[前后]))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=(个)?小时(?![以之]?[前后]))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=分钟(?![以之]?[前后]))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">minute</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">minute</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=秒钟(?![以之]?[前后]))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">second</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">d+(?=(个)?(周|星期|礼拜)(?![以之]?[前后]))&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">week</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span></div>

    <span class="c1"># 节假日相关</span>
<div class="viewcode-block" id="TimeUnit.norm_set_holiday"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_holiday">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_holiday</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(情人节)|(母亲节)|(青年节)|(教师节)|(中元节)|(端午)|(劳动节)|(7夕)|(建党节)|(建军节)|(初13)|(初14)|(初15)|&quot;</span> \
               <span class="s2">&quot;(初12)|(初11)|(初9)|(初8)|(初7)|(初6)|(初5)|(初4)|(初3)|(初2)|(初1)|(中和节)|(圣诞)|(中秋)|(春节)|(元宵)|&quot;</span> \
               <span class="s2">&quot;(航海日)|(儿童节)|(国庆)|(植树节)|(元旦)|(重阳节)|(妇女节)|(记者节)|(立春)|(雨水)|(惊蛰)|(春分)|(清明)|(谷雨)|&quot;</span> \
               <span class="s2">&quot;(立夏)|(小满 )|(芒种)|(夏至)|(小暑)|(大暑)|(立秋)|(处暑)|(白露)|(秋分)|(寒露)|(霜降)|(立冬)|(小雪)|(大雪)|&quot;</span> \
               <span class="s2">&quot;(冬至)|(小寒)|(大寒)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">holiday</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
            <span class="k">if</span> <span class="sa">u</span><span class="s1">&#39;节&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">holiday</span><span class="p">:</span>
                <span class="n">holiday</span> <span class="o">+=</span> <span class="sa">u</span><span class="s1">&#39;节&#39;</span>
            <span class="k">if</span> <span class="n">holiday</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">solar_holiday</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">solar_holiday</span><span class="p">[</span><span class="n">holiday</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">holiday</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">lunar_holiday</span><span class="p">:</span>
                <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">lunar_holiday</span><span class="p">[</span><span class="n">holiday</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">ls_converter</span> <span class="o">=</span> <span class="n">LunarSolarDateConverter</span><span class="p">()</span>
                <span class="n">lunar</span> <span class="o">=</span> <span class="n">LunarDate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">solar</span> <span class="o">=</span> <span class="n">ls_converter</span><span class="o">.</span><span class="n">lunar_to_solar</span><span class="p">(</span><span class="n">lunar</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">solar</span><span class="o">.</span><span class="n">solarYear</span>
                <span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">solar</span><span class="o">.</span><span class="n">solarMonth</span>
                <span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">solar</span><span class="o">.</span><span class="n">solarDay</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">holiday</span> <span class="o">=</span> <span class="n">holiday</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;节&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">holiday</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;小寒&#39;</span><span class="p">,</span> <span class="s1">&#39;大寒&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">china_24_st</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">holiday</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">date</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="TimeUnit.china_24_st"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.china_24_st">[文档]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">china_24_st</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">china_st</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;二十世纪和二十一世纪，24节气计算&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">19</span> <span class="o">==</span> <span class="n">year</span> <span class="o">//</span> <span class="mi">100</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">2000</span> <span class="o">==</span> <span class="n">year</span><span class="p">):</span>
            <span class="c1"># 20世纪key值</span>
            <span class="n">st_key</span> <span class="o">=</span> <span class="p">[</span><span class="mf">6.11</span><span class="p">,</span> <span class="mf">20.84</span><span class="p">,</span> <span class="mf">4.6295</span><span class="p">,</span> <span class="mf">19.4599</span><span class="p">,</span> <span class="mf">6.3826</span><span class="p">,</span> <span class="mf">21.4155</span><span class="p">,</span> <span class="mf">5.59</span><span class="p">,</span> <span class="mf">20.888</span><span class="p">,</span> <span class="mf">6.318</span><span class="p">,</span> <span class="mf">21.86</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">22.2</span><span class="p">,</span> <span class="mf">7.928</span><span class="p">,</span>
                      <span class="mf">23.65</span><span class="p">,</span> <span class="mf">8.35</span><span class="p">,</span> <span class="mf">23.95</span><span class="p">,</span> <span class="mf">8.44</span><span class="p">,</span> <span class="mf">23.822</span><span class="p">,</span> <span class="mf">9.098</span><span class="p">,</span> <span class="mf">24.218</span><span class="p">,</span> <span class="mf">8.218</span><span class="p">,</span> <span class="mf">23.08</span><span class="p">,</span> <span class="mf">7.9</span><span class="p">,</span> <span class="mf">22.6</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 21世纪key值</span>
            <span class="n">st_key</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.4055</span><span class="p">,</span> <span class="mf">20.12</span><span class="p">,</span> <span class="mf">3.87</span><span class="p">,</span> <span class="mf">18.73</span><span class="p">,</span> <span class="mf">5.63</span><span class="p">,</span> <span class="mf">20.646</span><span class="p">,</span> <span class="mf">4.81</span><span class="p">,</span> <span class="mf">20.1</span><span class="p">,</span> <span class="mf">5.52</span><span class="p">,</span> <span class="mf">21.04</span><span class="p">,</span> <span class="mf">5.678</span><span class="p">,</span> <span class="mf">21.37</span><span class="p">,</span> <span class="mf">7.108</span><span class="p">,</span> <span class="mf">22.83</span><span class="p">,</span>
                      <span class="mf">7.5</span><span class="p">,</span> <span class="mf">23.13</span><span class="p">,</span> <span class="mf">7.646</span><span class="p">,</span> <span class="mf">23.042</span><span class="p">,</span> <span class="mf">8.318</span><span class="p">,</span> <span class="mf">23.438</span><span class="p">,</span> <span class="mf">7.438</span><span class="p">,</span> <span class="mf">22.36</span><span class="p">,</span> <span class="mf">7.18</span><span class="p">,</span> <span class="mf">21.94</span><span class="p">]</span>
        <span class="c1"># 二十四节气字典-- key值, 月份，(特殊年份，相差天数)</span>
        <span class="n">solar_terms</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;小寒&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2019</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1982</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;大寒&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2082</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;立春&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;雨水&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2026</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;惊蛰&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;春分&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2084</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;清明&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;谷雨&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;立夏&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1911</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;小满&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;芒种&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1902</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;夏至&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;小暑&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1925</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;大暑&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1922</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;立秋&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;处暑&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;白露&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1927</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;秋分&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;寒露&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2088</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;霜降&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2089</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;立冬&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2089</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;小雪&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1978</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
            <span class="s1">&#39;大雪&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1954</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="s1">&#39;冬至&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">st_key</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1918</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">china_st</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;小寒&#39;</span><span class="p">,</span> <span class="s1">&#39;大寒&#39;</span><span class="p">,</span> <span class="s1">&#39;立春&#39;</span><span class="p">,</span> <span class="s1">&#39;雨水&#39;</span><span class="p">]:</span>
            <span class="n">flag_day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">year</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2422</span> <span class="o">+</span> <span class="n">solar_terms</span><span class="p">[</span><span class="n">china_st</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">year</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flag_day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">year</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2422</span> <span class="o">+</span> <span class="n">solar_terms</span><span class="p">[</span><span class="n">china_st</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">((</span><span class="n">year</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c1"># 特殊年份处理</span>
        <span class="k">for</span> <span class="n">special</span> <span class="ow">in</span> <span class="n">solar_terms</span><span class="p">[</span><span class="n">china_st</span><span class="p">][</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">year</span> <span class="o">==</span> <span class="n">special</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">flag_day</span> <span class="o">+=</span> <span class="n">special</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">solar_terms</span><span class="p">[</span><span class="n">china_st</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">flag_day</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.norm_set_cur_related"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.norm_set_cur_related">[文档]</a>    <span class="k">def</span> <span class="nf">norm_set_cur_related</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;设置当前时间相关的时间表达式 &quot;&quot;&quot;</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="p">,</span> <span class="s2">&quot;YYYY-M-D-H-m-s&quot;</span><span class="p">)</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;前年&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">years</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;去年&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">years</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;今年&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;明年&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;后年&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;上*上(个)?月&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;上&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">months</span><span class="o">=-</span><span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(本|这个)月&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;下*下(个)?月&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;下&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">))</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;大*大前天&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;大&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)))</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;!大)前天&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;昨&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;今(?!年)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;明(?!年)&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;!大)后天&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;大*大后天&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;大&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)))</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;=(上*上上(周|星期)))[1-7]?&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">week</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">week</span> <span class="o">-</span> <span class="n">cur</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;上&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">),</span> <span class="n">days</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;=((?&lt;!上)上(周|星期)))[1-7]?&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">week</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">week</span> <span class="o">-</span> <span class="n">cur</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">weeks</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;=((?&lt;!下)下(周|星期)))[1-7]?&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">week</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">week</span> <span class="o">-</span> <span class="n">cur</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;=(下*下下(周|星期)))[1-7]?&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">week</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">week</span> <span class="o">-</span> <span class="n">cur</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
            <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;下&quot;</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">),</span> <span class="n">days</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="s2">&quot;(?&lt;=((?&lt;!(上|下|个|[0-9]))(周|星期)))[1-7]&quot;</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exp_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">week</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">week</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">span</span> <span class="o">=</span> <span class="n">week</span> <span class="o">-</span> <span class="n">cur</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefer_future_week</span><span class="p">(</span><span class="n">week</span><span class="p">,</span> <span class="n">cur</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">day</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.modify_time_base"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.modify_time_base">[文档]</a>    <span class="k">def</span> <span class="nf">modify_time_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;该方法用于更新timeBase使之具有上下文关联性&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isTimeSpan</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">30</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1900</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2000</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">time_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">time_grid</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimeUnit.prefer_future_week"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.prefer_future_week">[文档]</a>    <span class="k">def</span> <span class="nf">prefer_future_week</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weekday</span><span class="p">,</span> <span class="n">cur</span><span class="p">):</span>
        <span class="c1"># 1. 确认用户选项</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isPreferFuture</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cur</span>
        <span class="c1"># 2. 检查被检查的时间级别之前，是否没有更高级的已经确定的时间，如果有，则不进行处理.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cur</span>
        <span class="c1"># 获取当前是在周几，如果识别到的时间小于当前时间，则识别时间为下一周</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="p">,</span> <span class="s2">&quot;YYYY-M-D-H-m-s&quot;</span><span class="p">)</span>
        <span class="n">week</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">week</span> <span class="o">&gt;</span> <span class="n">weekday</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span></div>

<div class="viewcode-block" id="TimeUnit.prefer_future"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.prefer_future">[文档]</a>    <span class="k">def</span> <span class="nf">prefer_future</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_time_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;如果用户选项是倾向于未来时间，检查check_time_index所指的时间是否是过去的时间，如果是的话，将大一级的时间设为当前时间的+1。</span>
<span class="sd">        如在晚上说“早上8点看书”，则识别为明天早上;</span>
<span class="sd">        12月31日说3号买菜，则识别为明年1月的3号。</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 1. 检查被检查的时间级别之前，是否没有更高级的已经确定的时间，如果有，则不进行处理.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">check_time_index</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="c1"># 2. 根据上下文补充时间</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_context_time</span><span class="p">(</span><span class="n">check_time_index</span><span class="p">)</span>
        <span class="c1"># 3. 根据上下文补充时间后再次检查被检查的时间级别之前，是否没有更高级的已经确定的时间，如果有，则不进行倾向处理.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">check_time_index</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># 4. 确认用户选项</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">isPreferFuture</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># 5. 获取当前时间，如果识别到的时间小于当前时间，则将其上的所有级别时间设置为当前时间，并且其上一级的时间步长+1</span>
        <span class="n">time_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">arrow</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="p">,</span> <span class="s2">&quot;YYYY-M-D-H-m-s&quot;</span><span class="p">)</span>
        <span class="n">cur_unit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_arr</span><span class="p">[</span><span class="n">check_time_index</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_no_year</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_no_year</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">cur_unit</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">check_time_index</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="c1"># 准备增加的时间单位是被检查的时间的上一级，将上一级时间+1</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_time</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">check_time_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">time_arr</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;YYYY-M-D-H-m-s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">check_time_index</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_arr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>

    <span class="k">def</span> <span class="nf">_check_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;检查未来时间点&quot;&quot;&quot;</span>
        <span class="n">time_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalizer</span><span class="o">.</span><span class="n">timeBase</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_year</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parse</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">parse</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">parse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_no_year</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="TimeUnit.check_context_time"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.check_context_time">[文档]</a>    <span class="k">def</span> <span class="nf">check_context_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_time_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;根据上下文时间补充时间信息&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">check_time_index</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp_origin</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp_origin</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># 在处理小时这个级别时，如果上文时间是下午的且下文没有主动声明小时级别以上的时间，则也把下文时间设为下午</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isFirstTimeSolveContext</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">check_time_index</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">tp_origin</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">check_time_index</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">12</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">check_time_index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tp</span><span class="o">.</span><span class="n">unit</span><span class="p">[</span><span class="n">check_time_index</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">12</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isFirstTimeSolveContext</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TimeUnit.add_time"><a class="viewcode-back" href="../../../../jtyoui.time.nlptime.html#jtyoui.time.nlptime.timeunit.TimeUnit.add_time">[文档]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">fore_unit</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fore_unit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fore_unit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fore_unit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fore_unit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fore_unit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fore_unit</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cur</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, 张伟

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>